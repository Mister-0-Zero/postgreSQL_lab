# –ó–µ–ª–µ–Ω–æ–≥—Ä–∞–¥—Å–∫–æ–µ –∫–ª–∞–¥–±–∏—â–µ ‚Äî –ø—Ä–æ–µ–∫—Ç –ø–æ –∫—É—Ä—Å—É "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã **"–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"**. –û–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ª–æ–≥–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –¥–ª—è —É—á–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞–¥–±–∏—â–∞—Ö, –º–æ–≥–∏–ª–∞—Ö, —É–º–µ—Ä—à–∏—Ö, —É—Å–ª—É–≥–∞—Ö –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞—Ö.

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –∫–ª–∞–¥–±–∏—â–∞–º–∏ –ó–µ–ª–µ–Ω–æ–≥—Ä–∞–¥–∞. –í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—é—â–∞—è –≤ —Å–µ–±—è –¥–∞–Ω–Ω—ã–µ –æ –º–æ–≥–∏–ª–∞—Ö, —É–º–µ—Ä—à–∏—Ö, —Ä–∏—Ç—É–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –∑–∞–∫–∞–∑–∞—Ö –∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞—Ö. –¢–∞–∫–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —É—á–∞—Å—Ç–∫–æ–≤.

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- PostgreSQL
- PL/pgSQL (–¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞)
- SQL (DDL, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Å–≤—è–∑–∏, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö)

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü:

| –¢–∞–±–ª–∏—Ü–∞         | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
|------------------|--------------------------------------------|
| `plots`          | –£—á–∞—Å—Ç–∫–∏ –∫–ª–∞–¥–±–∏—â–∞ (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ, –°–µ–≤–µ—Ä–Ω–æ–µ)   |
| `graves`         | –ú–æ–≥–∏–ª—ã —Å –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏     |
| `funeralagencies`| –†–∏—Ç—É–∞–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞                      |
| `deceased`       | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–º–µ—Ä—à–∏—Ö                     |
| `relatives`      | –†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ —É–º–µ—Ä—à–∏—Ö                      |
| `services`       | –£—Å–ª—É–≥–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –Ω–∞ –∫–ª–∞–¥–±–∏—â–µ       |
| `orders`         | –ó–∞–∫–∞–∑—ã –Ω–∞ —É—Å–ª—É–≥–∏                         |
| `variables`      | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏    |

## ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `NOT NULL`, `CHECK`, `UNIQUE` –∏ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ (`FOREIGN KEY`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –¥–∞—Ç: –¥–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è

## üîÑ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç—Ä–∏–≥–≥–µ—Ä `trg_set_grave_occupied`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å `is_occupied = true` —É –º–æ–≥–∏–ª—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É–º–µ—Ä—à–µ–≥–æ (`deceased`), –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∫ –Ω–µ–π.

```sql
create trigger trg_set_grave_occupied
after insert on deceased	
for each row
when (new.grave_id is not null)
execute procedure set_grave_occupied();
```
–¢–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç—Ä–∏–≥–≥–µ—Ä `add_burial_order`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É `orders` –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–≥–∏–±—à–µ–º, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ª—É–≥–∞ `–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ö–æ—Ä–æ–Ω`

```sql
CREATE OR REPLACE FUNCTION add_burial_order()
RETURNS TRIGGER AS $$
BEGIN
INSERT INTO orders (service_id, grave_id, order_date, status)
VALUES (1, NEW.grave_id, NEW.date_dead, '–≤—ã–ø–æ–ª–Ω–µ–Ω–æ');

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_add_burial_order
AFTER INSERT ON deceased
FOR EACH ROW
EXECUTE FUNCTION add_burial_order();
```
–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã (—Ñ–∞–π–ª add_index.sql) –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã (procedure.sql)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª create_DB.sql
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª create_tables_and_triggers.sql
3. –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ø—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å—Ç–∏–≤: add_index.sql
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª fill_DB.sql
5. –î–∞–ª–µ–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–ø—É—Å—Ç–∏–≤ procedure.sql
–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ñ–∞–π–ª–µ:
query_example.sql


# –ê–≤—Ç–æ—Ä:

- –õ—è–¥–∫–æ–≤ –ê–ª–µ–∫—Å–µ–π
- GitHub: @mister-0-zero

# –î–æ–ø.

–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö